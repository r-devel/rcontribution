[
    {
        "subtype": "bot_message",
        "text": "*[Bug 18658] New: Some 'base' examples use non-base functions, an error under R_DEFAULT_PACKAGES=NULL*\n<https:\/\/bugs.r-project.org\/show_bug.cgi?id=18658>\n\n            Bug ID: 18658\n           Summary: Some 'base' examples use non-base functions, an error\n                    under R_DEFAULT_PACKAGES=NULL\n           Product: R\n           Version: R-devel (trunk)\n          Hardware: All\n                OS: All\n            Status: UNCONFIRMED\n          Severity: minor\n          Priority: P5\n         Component: Documentation\n          Assignee: <mailto:R-core@R-project.org|R-core@R-project.org>\n          Reporter: <mailto:michaelchirico4@gmail.com|michaelchirico4@gmail.com>\n\nThe first such usage I noticed is `setNames()`. I confirm that the examples\ndon't work as intended under a minimal R session:\n\n```\nR_DEFAULT_PACKAGES=NULL R\nutils::example(\"nchar\")\n# ...\n# Error in setNames(, c(FALSE, NA, TRUE)) : \n#   could not find function \"setNames\"\n```\n\n<https:\/\/github.com\/search?q=repo%3Ar-devel%2Fr-svn%20path%3Abase%2Fman%2F%20%2FsetNames%5B>(%5D%2F&amp;type=code\n\nOptions:\n\n 1. Ignore this, users needing examples \"should\" not be in unusual sessions\nlike this\n 2. Use a workaround (e.g. here do `logi &lt;- c(FALSE, NA, TRUE); names(logi) &lt;-\nlogi`). I like this for readability.\n 3. Namespace-qualify such usages: `stats::setNames(, c(FALSE, NA, TRUE))`\n 4. Heed the long-standing (12+ years!) FIXME to move `setNames()` into base\nitself :)\n<https:\/\/github.com\/r-devel\/r-svn\/blob\/ac4660ef2e6eae48704882c7dd9d0aea34fef8f1\/src\/library\/stats\/R\/nlsFunc.R#L61-L66>\n\nOther examples with `setNames()`:\n<https:\/\/github.com\/search?q=repo%3Ar-devel%2Fr-svn%20path%3Abase%2Fman%2F%20%2FsetNames%5B>(%5D%2F&amp;type=code\n\nI'm searching now for other non-base functions used in base examples, for which\nsome of these options may not apply. I'll add them as further comments.",
        "username": "r-bugs notifier",
        "icons": {
            "emoji": ":robot_face:"
        },
        "type": "message",
        "ts": "1705826661.576159",
        "bot_id": "B06769YJX9Q",
        "app_id": "A024R9PQM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "dUy",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "[Bug 18658] New: Some 'base' examples use non-base functions, an error under R_DEFAULT_PACKAGES=NULL",
                                "style": {
                                    "bold": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "\n"
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/bugs.r-project.org\/show_bug.cgi?id=18658"
                            },
                            {
                                "type": "text",
                                "text": "\n\n            Bug ID: 18658\n           Summary: Some 'base' examples use non-base functions, an error\n                    under R_DEFAULT_PACKAGES=NULL\n           Product: R\n           Version: R-devel (trunk)\n          Hardware: All\n                OS: All\n            Status: UNCONFIRMED\n          Severity: minor\n          Priority: P5\n         Component: Documentation\n          Assignee: "
                            },
                            {
                                "type": "link",
                                "url": "mailto:R-core@R-project.org",
                                "text": "R-core@R-project.org",
                                "unsafe": true
                            },
                            {
                                "type": "text",
                                "text": "\n          Reporter: "
                            },
                            {
                                "type": "link",
                                "url": "mailto:michaelchirico4@gmail.com",
                                "text": "michaelchirico4@gmail.com"
                            },
                            {
                                "type": "text",
                                "text": "\n\nThe first such usage I noticed is "
                            },
                            {
                                "type": "text",
                                "text": "setNames()",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": ". I confirm that the examples\ndon't work as intended under a minimal R session:\n\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_preformatted",
                        "elements": [
                            {
                                "type": "text",
                                "text": "R_DEFAULT_PACKAGES=NULL R\nutils::example(\"nchar\")\n# ...\n# Error in setNames(, c(FALSE, NA, TRUE)) : \n#   could not find function \"setNames\"\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "\n\n"
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/github.com\/search?q=repo%3Ar-devel%2Fr-svn%20path%3Abase%2Fman%2F%20%2FsetNames%5B"
                            },
                            {
                                "type": "text",
                                "text": "(%5D%2F&type=code\n\nOptions:\n\n 1. Ignore this, users needing examples \"should\" not be in unusual sessions\nlike this\n 2. Use a workaround (e.g. here do `logi <- c(FALSE, NA, TRUE); names(logi) <-\nlogi`). I like this for readability.\n 3. Namespace-qualify such usages: "
                            },
                            {
                                "type": "text",
                                "text": "stats::setNames(, c(FALSE, NA, TRUE))",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "\n 4. Heed the long-standing (12+ years!) FIXME to move "
                            },
                            {
                                "type": "text",
                                "text": "setNames()",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " into base\nitself :)\n"
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/github.com\/r-devel\/r-svn\/blob\/ac4660ef2e6eae48704882c7dd9d0aea34fef8f1\/src\/library\/stats\/R\/nlsFunc.R#L61-L66"
                            },
                            {
                                "type": "text",
                                "text": "\n\nOther examples with "
                            },
                            {
                                "type": "text",
                                "text": "setNames()",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": ":\n"
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/github.com\/search?q=repo%3Ar-devel%2Fr-svn%20path%3Abase%2Fman%2F%20%2FsetNames%5B"
                            },
                            {
                                "type": "text",
                                "text": "(%5D%2F&type=code\n\nI'm searching now for other non-base functions used in base examples, for which\nsome of these options may not apply. I'll add them as further comments."
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "subtype": "bot_message",
        "text": "*[Bug 18658] Some 'base' examples use non-base functions, an error under R_DEFAULT_PACKAGES=NULL*\n<https:\/\/bugs.r-project.org\/show_bug.cgi?id=18658>\n\n--- Comment #1 from Michael Chirico (<mailto:michaelchirico4@gmail.com|michaelchirico4@gmail.com>) ---\nTurns out this is a much broader issue -- I count &gt;1000 usages in\nsrc\/library\/*\/man of functions that would not be loaded under a minimal R\nsession. Here's the breakdown for base alone:\n\n```\n               culprit culprit_package  N\n 1:                str           utils 47\n 2:              rnorm           stats 29\n 3:              runif           stats 24\n 4:                 df           stats 22\n 5:                 lm           stats 20\n 6:               head           utils 16\n 7:           quantile           stats 12\n 8:             legend        graphics 11\n 9:              lines        graphics  9\n10:            pattern            grid  8\n11:                 ns         splines  8\n12:             abline        graphics  7\n13:           setNames           stats  7\n14:                new         methods  7\n15:               tail           utils  6\n16:                 ar           stats  6\n17:              rpois           stats  5\n18:                  D           stats  5\n19:                 rt           stats  5\n20:                par        graphics  5\n21:            boxplot        graphics  5\n22:                 as         methods  4\n23:              mtext        graphics  4\n24:                 sd           stats  4\n25:              curve        graphics  4\n26:                 cm       grDevices  4\n27:        object.size           utils  4\n28:            methods           utils  4\n29:             median           stats  4\n30:             ls.str           utils  3\n31:            matplot        graphics  3\n32:               axis        graphics  3\n33:              title        graphics  3\n34:          aggregate           stats  3\n35:               hist        graphics  3\n36:           getClass         methods  3\n37:              xtabs           stats  3\n38:              Gamma           stats  3\n39:                 pt           stats  3\n40:                 dt           stats  3\n41:             t.test           stats  2\n42:               find           utils  2\n43:       interpSpline         splines  2\n44:               coef           stats  2\n45:             points        graphics  2\n46:                var           stats  2\n47:            poisson           stats  2\n48:            fivenum           stats  2\n49:             rbinom           stats  2\n50:            rcauchy           stats  2\n51:             symnum           stats  2\n52:     capture.output           utils  2\n53:            barplot        graphics  2\n54:                mad           stats  2\n55:              ar.yw           stats  2\n56:                glm           stats  2\n57:       plot.default        graphics  1\n58:         read.delim           utils  1\n59:               View           utils  1\n60:                 is         methods  1\n61:            density           stats  1\n62:          approxfun           stats  1\n63:        assertError           tools  1\n64:         formalArgs         methods  1\n65:        getClassDef         methods  1\n66:              pnorm           stats  1\n67:        ansari.test           stats  1\n68:         read.table           utils  1\n69:             cmpfun        compiler  1\n70:                x11       grDevices  1\n71:               rexp           stats  1\n72:            formula           stats  1\n73: packageDescription           utils  1\n74:                  C           stats  1\n75:             spline           stats  1\n76:       getParseData           utils  1\n77:               dist           stats  1\n78:             lowess           stats  1\n79:                 ts           stats  1\n80:             rlnorm           stats  1\n81:             rchisq           stats  1\n82:          qbirthday           stats  1\n",
        "username": "r-bugs notifier",
        "icons": {
            "emoji": ":robot_face:"
        },
        "type": "message",
        "ts": "1705829283.936789",
        "bot_id": "B06769YJX9Q",
        "app_id": "A024R9PQM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "ciK",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "[Bug 18658] Some 'base' examples use non-base functions, an error under R_DEFAULT_PACKAGES=NULL",
                                "style": {
                                    "bold": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "\n"
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/bugs.r-project.org\/show_bug.cgi?id=18658"
                            },
                            {
                                "type": "text",
                                "text": "\n\n--- Comment #1 from Michael Chirico ("
                            },
                            {
                                "type": "link",
                                "url": "mailto:michaelchirico4@gmail.com",
                                "text": "michaelchirico4@gmail.com"
                            },
                            {
                                "type": "text",
                                "text": ") ---\nTurns out this is a much broader issue -- I count >1000 usages in\nsrc\/library\/*\/man of functions that would not be loaded under a minimal R\nsession. Here's the breakdown for base alone:\n\n```\n               culprit culprit_package  N\n 1:                str           utils 47\n 2:              rnorm           stats 29\n 3:              runif           stats 24\n 4:                 df           stats 22\n 5:                 lm           stats 20\n 6:               head           utils 16\n 7:           quantile           stats 12\n 8:             legend        graphics 11\n 9:              lines        graphics  9\n10:            pattern            grid  8\n11:                 ns         splines  8\n12:             abline        graphics  7\n13:           setNames           stats  7\n14:                new         methods  7\n15:               tail           utils  6\n16:                 ar           stats  6\n17:              rpois           stats  5\n18:                  D           stats  5\n19:                 rt           stats  5\n20:                par        graphics  5\n21:            boxplot        graphics  5\n22:                 as         methods  4\n23:              mtext        graphics  4\n24:                 sd           stats  4\n25:              curve        graphics  4\n26:                 cm       grDevices  4\n27:        object.size           utils  4\n28:            methods           utils  4\n29:             median           stats  4\n30:             ls.str           utils  3\n31:            matplot        graphics  3\n32:               axis        graphics  3\n33:              title        graphics  3\n34:          aggregate           stats  3\n35:               hist        graphics  3\n36:           getClass         methods  3\n37:              xtabs           stats  3\n38:              Gamma           stats  3\n39:                 pt           stats  3\n40:                 dt           stats  3\n41:             t.test           stats  2\n42:               find           utils  2\n43:       interpSpline         splines  2\n44:               coef           stats  2\n45:             points        graphics  2\n46:                var           stats  2\n47:            poisson           stats  2\n48:            fivenum           stats  2\n49:             rbinom           stats  2\n50:            rcauchy           stats  2\n51:             symnum           stats  2\n52:     capture.output           utils  2\n53:            barplot        graphics  2\n54:                mad           stats  2\n55:              ar.yw           stats  2\n56:                glm           stats  2\n57:       plot.default        graphics  1\n58:         read.delim           utils  1\n59:               View           utils  1\n60:                 is         methods  1\n61:            density           stats  1\n62:          approxfun           stats  1\n63:        assertError           tools  1\n64:         formalArgs         methods  1\n65:        getClassDef         methods  1\n66:              pnorm           stats  1\n67:        ansari.test           stats  1\n68:         read.table           utils  1\n69:             cmpfun        compiler  1\n70:                x11       grDevices  1\n71:               rexp           stats  1\n72:            formula           stats  1\n73: packageDescription           utils  1\n74:                  C           stats  1\n75:             spline           stats  1\n76:       getParseData           utils  1\n77:               dist           stats  1\n78:             lowess           stats  1\n79:                 ts           stats  1\n80:             rlnorm           stats  1\n81:             rchisq           stats  1\n82:          qbirthday           stats  1"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "subtype": "bot_message",
        "text": "83:                cov           stats  1\n84:              cycle           stats  1\n85:              anova           stats  1\n86:              resid           stats  1\n87:       power.t.test           stats  1\n88:            recover           utils  1\n89:         ps.options       grDevices  1\n90:            contour        graphics  1\n91:              combn           utils  1\n               culprit culprit_package  N\n```\n\nScript for finding such usages:\n\n```\nlibrary(data.table)\nlibrary(lintr)\n\nsetwd('src\/library')\n\n# stats4 doesn't export any new objects, remove ambiguity below\nall_pkgs &lt;-\n  setdiff(tools:::.get_standard_package_names()$base, \"stats4\")\nall_exports &lt;- lapply(all_pkgs, getNamespaceExports)\nall_exports &lt;- data.table::data.table(\n  package = rep(all_pkgs, lengths(all_exports)),\n  export = unlist(all_exports),\n  key = \"package\"\n)\n\ndirs &lt;- list.files()\ndirs &lt;- dirs[dir.exists(file.path(dirs, 'man'))]\n\nall_issues &lt;- data.table::rbindlist(lapply(dirs, function(dir) {\n  cant_use &lt;- setdiff(\n    all_exports$export,\n    all_exports[c(\"base\", dir), export]\n  )\n  linter &lt;- lintr::undesirable_function_linter(\n    setNames(rep(NA, length(cant_use)), cant_use)\n  )\n\n  man_pages &lt;- list.files(file.path(dir, 'man'), pattern = \"\\\\.Rd\", full.names\n= TRUE)\n\n  data.table::rbindlist(lapply(man_pages, function(man_page) {\n    tmp &lt;- tempfile()\n    on.exit(unlink(tmp))\n\n    tools::Rd2ex(man_page, tmp)\n    if (file.exists(tmp)) {\n      res &lt;- data.table::as.data.table(lintr::lint(tmp, linter))\n      res[, `:=`(\n        package = dir,\n        filename = man_page,\n        culprit = gsub('.*\"(.*)\".*', '\\\\1', message)\n      )]\n      res\n    }\n  }))\n}))\n\ndata.table::setkey(all_exports, export)\nall_issues[, culprit_package := all_exports[.(culprit), package]]\n```\n\nThis makes me lean towards a 5th option:\n\n 5. Ignore this, but be aware moving forward &amp; try to fix the issue\nincrementally.",
        "username": "r-bugs notifier",
        "icons": {
            "emoji": ":robot_face:"
        },
        "type": "message",
        "ts": "1705829283.964269",
        "bot_id": "B06769YJX9Q",
        "app_id": "A024R9PQM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "ZDcV4",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "83:                cov           stats  1\n84:              cycle           stats  1\n85:              anova           stats  1\n86:              resid           stats  1\n87:       power.t.test           stats  1\n88:            recover           utils  1\n89:         ps.options       grDevices  1\n90:            contour        graphics  1\n91:              combn           utils  1\n               culprit culprit_package  N"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_preformatted",
                        "elements": [
                            {
                                "type": "text",
                                "text": "\nScript for finding such usages:\n\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "library(data.table)\nlibrary(lintr)\n\nsetwd('src\/library')\n\n# stats4 doesn't export any new objects, remove ambiguity below\nall_pkgs <-\n  setdiff(tools:::.get_standard_package_names()$base, \"stats4\")\nall_exports <- lapply(all_pkgs, getNamespaceExports)\nall_exports <- data.table::data.table(\n  package = rep(all_pkgs, lengths(all_exports)),\n  export = unlist(all_exports),\n  key = \"package\"\n)\n\ndirs <- list.files()\ndirs <- dirs[dir.exists(file.path(dirs, 'man'))]\n\nall_issues <- data.table::rbindlist(lapply(dirs, function(dir) {\n  cant_use <- setdiff(\n    all_exports$export,\n    all_exports[c(\"base\", dir), export]\n  )\n  linter <- lintr::undesirable_function_linter(\n    setNames(rep(NA, length(cant_use)), cant_use)\n  )\n\n  man_pages <- list.files(file.path(dir, 'man'), pattern = \"\\\\.Rd\", full.names\n= TRUE)\n\n  data.table::rbindlist(lapply(man_pages, function(man_page) {\n    tmp <- tempfile()\n    on.exit(unlink(tmp))\n\n    tools::Rd2ex(man_page, tmp)\n    if (file.exists(tmp)) {\n      res <- data.table::as.data.table(lintr::lint(tmp, linter))\n      res[, "
                            },
                            {
                                "type": "text",
                                "text": ":=",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "(\n        package = dir,\n        filename = man_page,\n        culprit = gsub('."
                            },
                            {
                                "type": "text",
                                "text": "\"(.",
                                "style": {
                                    "bold": true
                                }
                            },
                            {
                                "type": "text",
                                "text": ")\".*', '\\\\1', message)\n      )]\n      res\n    }\n  }))\n}))\n\ndata.table::setkey(all_exports, export)\nall_issues[, culprit_package := all_exports[.(culprit), package]]\n```\n\nThis makes me lean towards a 5th option:\n\n 5. Ignore this, but be aware moving forward & try to fix the issue\nincrementally."
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "subtype": "bot_message",
        "text": "*[Bug 18658] Some 'base' examples use non-base functions, an error under R_DEFAULT_PACKAGES=NULL*\n<https:\/\/bugs.r-project.org\/show_bug.cgi?id=18658>\n\n--- Comment #2 from Michael Chirico (<mailto:michaelchirico4@gmail.com|michaelchirico4@gmail.com>) ---\nThe above won't find cases where e.g. `library(graphics)` or\n`require(graphics)` is correctly run in the example, so here's an attempt to\nremove those false positives. It will only find the first unqualified name in a\ngiven Rd, so should be combined with the above when writing a fix.\n\n```\nlibrary(data.table)\nsetwd('src\/library')\n\ndirs &lt;- list.files()\ndirs &lt;- dirs[dir.exists(file.path(dirs, 'man'))]\n\nall_issues &lt;- data.table::rbindlist(lapply(dirs, function(dir) {\n  man_dir &lt;- file.path(dir, 'man')\n  man_pages &lt;- list.files(man_dir, pattern = \"\\\\.Rd\", full.names = TRUE)\n\n  data.table::rbindlist(lapply(man_pages, function(man_page) {\n    ex &lt;- tempfile()\n    err &lt;- tempfile()\n    on.exit(unlink(c(ex, err)))\n    tools::Rd2ex(man_page, ex)\n    if (!file.exists(ex)) return(NULL)\n    system2(\"Rscript\",\n      c(\"-e\", sprintf(\"'source(\\\"%s\\\")'\", ex)),\n      stdout = FALSE, stderr = err,\n      env = sprintf(\"R_DEFAULT_PACKAGES=%s\", dir)\n    )\n    issues &lt;- gsub(\"\\\\s+\", \" \", readChar(err, file.size(err)))\n    issues &lt;- grep(\"could not find function\", issues, value = TRUE)\n    if (!length(issues)) return(NULL)\n    data.table::data.table(package = dir, rd_file = man_page,\n      culprit = gsub('.*could not find function \"([^\"]*)\".*', \"\\\\1\", issues)\n    )\n  }))\n}))\n\nall_issues[, by = culprit, culprit_package := with(getAnywhere(.BY$culprit),\nwhere[!dups])]\n# drop unmatched cases, AFAICT only due to mismatch of R version I used vs.\nr-devel: Tailcall, %||%\nall_issues = all_issues[startsWith(culprit_package, \"package:\")]\nall_issues[, culprit_package := gsub(\"package:\", \"\", culprit_package)]\n```\n\nThis list is much more manageable: only 89 Rd files fail due to errors related\nto unfound functions:\n\n```\n                                   rd_file culprit_package            culprit\n 1:                 base\/man\/as.POSIXlt.Rd           utils                str\n 2:             base\/man\/balancePOSIXlt.Rd           utils                str\n 3:                       base\/man\/call.Rd           stats           setNames\n 4:                      base\/man\/cbind.Rd           stats           setNames\n 5:                    base\/man\/chkDots.Rd           stats            density\n 6:                 base\/man\/cut.POSIXt.Rd           stats          aggregate\n 7:                   base\/man\/dimnames.Rd           utils               tail\n 8:                       base\/man\/dput.Rd           stats           setNames\n 9:                    base\/man\/formals.Rd           utils                str\n10:                     base\/man\/format.Rd           stats           setNames\n11:                    base\/man\/formatc.Rd           utils               head\n12:                      base\/man\/gzcon.Rd           utils         read.table\n13:                      base\/man\/iconv.Rd           utils                str\n14:                  base\/man\/identical.Rd           stats            poisson\n15:                     base\/man\/ifelse.Rd           utils               head\n16:              base\/man\/library.dynam.Rd           utils               tail\n17:                   base\/man\/list2env.Rd           stats              rnorm\n18:                    base\/man\/locales.Rd           stats           setNames\n19:                      base\/man\/match.Rd           stats             symnum\n20:                      base\/man\/nchar.Rd           stats           setNames\n21:                      base\/man\/parse.Rd           utils       getParseData\n22:                     base\/man\/pipeOp.Rd           utils               head\n23:                  base\/man\/proc.time.Rd           stats                mad\n24:                         base\/man\/qr.Rd           stats              runif\n",
        "username": "r-bugs notifier",
        "icons": {
            "emoji": ":robot_face:"
        },
        "type": "message",
        "ts": "1705885371.342949",
        "bot_id": "B06769YJX9Q",
        "app_id": "A024R9PQM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "1GDq",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "[Bug 18658] Some 'base' examples use non-base functions, an error under R_DEFAULT_PACKAGES=NULL",
                                "style": {
                                    "bold": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "\n"
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/bugs.r-project.org\/show_bug.cgi?id=18658"
                            },
                            {
                                "type": "text",
                                "text": "\n\n--- Comment #2 from Michael Chirico ("
                            },
                            {
                                "type": "link",
                                "url": "mailto:michaelchirico4@gmail.com",
                                "text": "michaelchirico4@gmail.com"
                            },
                            {
                                "type": "text",
                                "text": ") ---\nThe above won't find cases where e.g. "
                            },
                            {
                                "type": "text",
                                "text": "library(graphics)",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " or\n"
                            },
                            {
                                "type": "text",
                                "text": "require(graphics)",
                                "style": {
                                    "code": true
                                }
                            },
                            {
                                "type": "text",
                                "text": " is correctly run in the example, so here's an attempt to\nremove those false positives. It will only find the first unqualified name in a\ngiven Rd, so should be combined with the above when writing a fix.\n\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_preformatted",
                        "elements": [
                            {
                                "type": "text",
                                "text": "library(data.table)\nsetwd('src\/library')\n\ndirs <- list.files()\ndirs <- dirs[dir.exists(file.path(dirs, 'man'))]\n\nall_issues <- data.table::rbindlist(lapply(dirs, function(dir) {\n  man_dir <- file.path(dir, 'man')\n  man_pages <- list.files(man_dir, pattern = \"\\\\.Rd\", full.names = TRUE)\n\n  data.table::rbindlist(lapply(man_pages, function(man_page) {\n    ex <- tempfile()\n    err <- tempfile()\n    on.exit(unlink(c(ex, err)))\n    tools::Rd2ex(man_page, ex)\n    if (!file.exists(ex)) return(NULL)\n    system2(\"Rscript\",\n      c(\"-e\", sprintf(\"'source(\\\"%s\\\")'\", ex)),\n      stdout = FALSE, stderr = err,\n      env = sprintf(\"R_DEFAULT_PACKAGES=%s\", dir)\n    )\n    issues <- gsub(\"\\\\s+\", \" \", readChar(err, file.size(err)))\n    issues <- grep(\"could not find function\", issues, value = TRUE)\n    if (!length(issues)) return(NULL)\n    data.table::data.table(package = dir, rd_file = man_page,\n      culprit = gsub('.*could not find function \"([^\"]*)\".*', \"\\\\1\", issues)\n    )\n  }))\n}))\n\nall_issues[, by = culprit, culprit_package := with(getAnywhere(.BY$culprit),\nwhere[!dups])]\n# drop unmatched cases, AFAICT only due to mismatch of R version I used vs.\nr-devel: Tailcall, %||%\nall_issues = all_issues[startsWith(culprit_package, \"package:\")]\nall_issues[, culprit_package := gsub(\"package:\", \"\", culprit_package)]\n"
                            }
                        ]
                    },
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "\n\nThis list is much more manageable: only 89 Rd files fail due to errors related\nto unfound functions:\n\n```\n                                   rd_file culprit_package            culprit\n 1:                 base\/man\/as.POSIXlt.Rd           utils                str\n 2:             base\/man\/balancePOSIXlt.Rd           utils                str\n 3:                       base\/man\/call.Rd           stats           setNames\n 4:                      base\/man\/cbind.Rd           stats           setNames\n 5:                    base\/man\/chkDots.Rd           stats            density\n 6:                 base\/man\/cut.POSIXt.Rd           stats          aggregate\n 7:                   base\/man\/dimnames.Rd           utils               tail\n 8:                       base\/man\/dput.Rd           stats           setNames\n 9:                    base\/man\/formals.Rd           utils                str\n10:                     base\/man\/format.Rd           stats           setNames\n11:                    base\/man\/formatc.Rd           utils               head\n12:                      base\/man\/gzcon.Rd           utils         read.table\n13:                      base\/man\/iconv.Rd           utils                str\n14:                  base\/man\/identical.Rd           stats            poisson\n15:                     base\/man\/ifelse.Rd           utils               head\n16:              base\/man\/library.dynam.Rd           utils               tail\n17:                   base\/man\/list2env.Rd           stats              rnorm\n18:                    base\/man\/locales.Rd           stats           setNames\n19:                      base\/man\/match.Rd           stats             symnum\n20:                      base\/man\/nchar.Rd           stats           setNames\n21:                      base\/man\/parse.Rd           utils       getParseData\n22:                     base\/man\/pipeOp.Rd           utils               head\n23:                  base\/man\/proc.time.Rd           stats                mad\n24:                         base\/man\/qr.Rd           stats              runif"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "subtype": "bot_message",
        "text": "25:                     base\/man\/Quotes.Rd           stats             rchisq\n26:              base\/man\/rawConversion.Rd           utils                str\n27:                 base\/man\/regmatches.Rd           utils               head\n28:                     base\/man\/substr.Rd           utils                str\n29:                 base\/man\/Sys.getenv.Rd           utils               head\n30:            base\/man\/textconnections.Rd           stats              anova\n31:                  base\/man\/timezones.Rd           utils                str\n32:                      base\/man\/trace.Rd        graphics               hist\n33:                       base\/man\/Trig.Rd           utils               head\n34:                   base\/man\/warnings.Rd           utils               tail\n35:                   datasets\/man\/iris.Rd        graphics              pairs\n36:                    datasets\/man\/npk.Rd           stats                aov\n37:                  datasets\/man\/sleep.Rd        graphics         stripchart\n38:           datasets\/man\/sunspot.year.Rd           stats              start\n39:                graphics\/man\/axTicks.Rd       grDevices        adjustcolor\n40:         graphics\/man\/boxplot.matrix.Rd           stats              rnorm\n41:                   graphics\/man\/clip.Rd           stats              rnorm\n42:               graphics\/man\/identify.Rd       grDevices    dev.interactive\n43:          graphics\/man\/smoothScatter.Rd           stats              rnorm\n44:           grDevices\/man\/adjustcolor.Rd        graphics            matplot\n45:                grDevices\/man\/colors.Rd           utils               demo\n46:              grDevices\/man\/densCols.Rd           stats              rnorm\n47:                   grDevices\/man\/hcl.Rd           utils               demo\n48:               grDevices\/man\/palette.Rd           stats              rnorm\n49:                   grDevices\/man\/pdf.Rd        graphics                par\n50:                    grid\/man\/as.mask.Rd       grDevices                rgb\n51:           grid\/man\/calcStringMetric.Rd       grDevices            n2mfrow\n52:                   grid\/man\/grid.cap.Rd       grDevices            dev.new\n53:                 grid\/man\/grid.group.Rd       grDevices   dev.capabilities\n54:               grid\/man\/grid.locator.Rd       grDevices    dev.interactive\n55:                    grid\/man\/grid.ls.Rd           utils                str\n56:                grid\/man\/grid.raster.Rd       grDevices                hcl\n57:                grid\/man\/grid.stroke.Rd       grDevices                rgb\n58:                   grid\/man\/showGrob.Rd       grDevices                rgb\n59:               grid\/man\/showViewport.Rd       grDevices                rgb\n60:           methods\/man\/localRefClass.Rd           stats              rnorm\n61: methods\/man\/Methods_for_Nongenerics.Rd           stats              rnorm\n62:              methods\/man\/NextMethod.Rd           stats              runif\n63:                  methods\/man\/S3Part.Rd           stats                 lm\n64:                methods\/man\/setClass.Rd           stats              rnorm\n65:               methods\/man\/setMethod.Rd           stats              qnorm\n66:        methods\/man\/StructureClasses.Rd           utils                str\n67:                 stats\/man\/as.hclust.Rd        graphics                par\n68:                      stats\/man\/Beta.Rd        graphics            matplot\n69:               stats\/man\/Exponential.Rd        graphics             abline\n70:                    stats\/man\/family.Rd        graphics              lines\n71:                    stats\/man\/kmeans.Rd           utils               head\n72:                     stats\/man\/lmfit.Rd        graphics            boxplot\n73:              stats\/man\/numericDeriv.Rd           utils                str\n74:                   stats\/man\/ppoints.Rd       grDevices        adjustcolor\n",
        "username": "r-bugs notifier",
        "icons": {
            "emoji": ":robot_face:"
        },
        "type": "message",
        "ts": "1705885371.377179",
        "bot_id": "B06769YJX9Q",
        "app_id": "A024R9PQM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "9xkt",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "25:                     base\/man\/Quotes.Rd           stats             rchisq\n26:              base\/man\/rawConversion.Rd           utils                str\n27:                 base\/man\/regmatches.Rd           utils               head\n28:                     base\/man\/substr.Rd           utils                str\n29:                 base\/man\/Sys.getenv.Rd           utils               head\n30:            base\/man\/textconnections.Rd           stats              anova\n31:                  base\/man\/timezones.Rd           utils                str\n32:                      base\/man\/trace.Rd        graphics               hist\n33:                       base\/man\/Trig.Rd           utils               head\n34:                   base\/man\/warnings.Rd           utils               tail\n35:                   datasets\/man\/iris.Rd        graphics              pairs\n36:                    datasets\/man\/npk.Rd           stats                aov\n37:                  datasets\/man\/sleep.Rd        graphics         stripchart\n38:           datasets\/man\/sunspot.year.Rd           stats              start\n39:                graphics\/man\/axTicks.Rd       grDevices        adjustcolor\n40:         graphics\/man\/boxplot.matrix.Rd           stats              rnorm\n41:                   graphics\/man\/clip.Rd           stats              rnorm\n42:               graphics\/man\/identify.Rd       grDevices    dev.interactive\n43:          graphics\/man\/smoothScatter.Rd           stats              rnorm\n44:           grDevices\/man\/adjustcolor.Rd        graphics            matplot\n45:                grDevices\/man\/colors.Rd           utils               demo\n46:              grDevices\/man\/densCols.Rd           stats              rnorm\n47:                   grDevices\/man\/hcl.Rd           utils               demo\n48:               grDevices\/man\/palette.Rd           stats              rnorm\n49:                   grDevices\/man\/pdf.Rd        graphics                par\n50:                    grid\/man\/as.mask.Rd       grDevices                rgb\n51:           grid\/man\/calcStringMetric.Rd       grDevices            n2mfrow\n52:                   grid\/man\/grid.cap.Rd       grDevices            dev.new\n53:                 grid\/man\/grid.group.Rd       grDevices   dev.capabilities\n54:               grid\/man\/grid.locator.Rd       grDevices    dev.interactive\n55:                    grid\/man\/grid.ls.Rd           utils                str\n56:                grid\/man\/grid.raster.Rd       grDevices                hcl\n57:                grid\/man\/grid.stroke.Rd       grDevices                rgb\n58:                   grid\/man\/showGrob.Rd       grDevices                rgb\n59:               grid\/man\/showViewport.Rd       grDevices                rgb\n60:           methods\/man\/localRefClass.Rd           stats              rnorm\n61: methods\/man\/Methods_for_Nongenerics.Rd           stats              rnorm\n62:              methods\/man\/NextMethod.Rd           stats              runif\n63:                  methods\/man\/S3Part.Rd           stats                 lm\n64:                methods\/man\/setClass.Rd           stats              rnorm\n65:               methods\/man\/setMethod.Rd           stats              qnorm\n66:        methods\/man\/StructureClasses.Rd           utils                str\n67:                 stats\/man\/as.hclust.Rd        graphics                par\n68:                      stats\/man\/Beta.Rd        graphics            matplot\n69:               stats\/man\/Exponential.Rd        graphics             abline\n70:                    stats\/man\/family.Rd        graphics              lines\n71:                    stats\/man\/kmeans.Rd           utils               head\n72:                     stats\/man\/lmfit.Rd        graphics            boxplot\n73:              stats\/man\/numericDeriv.Rd           utils                str\n74:                   stats\/man\/ppoints.Rd       grDevices        adjustcolor"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "subtype": "bot_message",
        "text": "75:                stats\/man\/smoothEnds.Rd       grDevices        adjustcolor\n76:                 stats\/man\/splinefun.Rd           utils                str\n77:                        stats\/man\/ts.Rd           utils               head\n78:                   stats\/man\/uniroot.Rd        graphics              curve\n79:                      stats4\/man\/mle.Rd           stats     model.response\n80:             tcltk\/man\/tkProgressBar.Rd           stats              runif\n81:                  tools\/man\/bibstyle.Rd           utils           bibentry\n82:            tools\/man\/buildVignettes.Rd           utils                str\n83:                 tools\/man\/CRANtools.Rd           utils               head\n84:      tools\/man\/package_dependencies.Rd           utils available.packages\n85:      tools\/man\/testInstalledPackage.Rd           utils                str\n86:                    tools\/man\/toHTML.Rd           utils               demo\n87:            tools\/man\/vignetteEngine.Rd           utils                str\n88:              tools\/man\/vignetteInfo.Rd           utils                str\n89:            utils\/man\/txtProgressBar.Rd           stats              runif\n                                   rd_file culprit_package            culprit\n```",
        "username": "r-bugs notifier",
        "icons": {
            "emoji": ":robot_face:"
        },
        "type": "message",
        "ts": "1705885371.402249",
        "bot_id": "B06769YJX9Q",
        "app_id": "A024R9PQM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "HOMDL",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "75:                stats\/man\/smoothEnds.Rd       grDevices        adjustcolor\n76:                 stats\/man\/splinefun.Rd           utils                str\n77:                        stats\/man\/ts.Rd           utils               head\n78:                   stats\/man\/uniroot.Rd        graphics              curve\n79:                      stats4\/man\/mle.Rd           stats     model.response\n80:             tcltk\/man\/tkProgressBar.Rd           stats              runif\n81:                  tools\/man\/bibstyle.Rd           utils           bibentry\n82:            tools\/man\/buildVignettes.Rd           utils                str\n83:                 tools\/man\/CRANtools.Rd           utils               head\n84:      tools\/man\/package_dependencies.Rd           utils available.packages\n85:      tools\/man\/testInstalledPackage.Rd           utils                str\n86:                    tools\/man\/toHTML.Rd           utils               demo\n87:            tools\/man\/vignetteEngine.Rd           utils                str\n88:              tools\/man\/vignetteInfo.Rd           utils                str\n89:            utils\/man\/txtProgressBar.Rd           stats              runif\n                                   rd_file culprit_package            culprit\n```"
                            }
                        ]
                    }
                ]
            }
        ]
    },
    {
        "subtype": "bot_message",
        "text": "*[Bug 18658] Some 'base' examples use non-base functions, an error under R_DEFAULT_PACKAGES=NULL*\n<https:\/\/bugs.r-project.org\/show_bug.cgi?id=18658>\n\n--- Comment #3 from Michael Chirico (<mailto:michaelchirico4@gmail.com|michaelchirico4@gmail.com>) ---\nCreated attachment 3296\n  --&gt; <https:\/\/bugs.r-project.org\/attachment.cgi?id=3296&amp;action=edit>\nFixes for examples in src\/library\/base\/man\n\nAttaching a patch for base -- happy to continue for the other default packages\npending feedback before sinking more time here.",
        "username": "r-bugs notifier",
        "icons": {
            "emoji": ":robot_face:"
        },
        "type": "message",
        "ts": "1705886725.666399",
        "bot_id": "B06769YJX9Q",
        "app_id": "A024R9PQM",
        "blocks": [
            {
                "type": "rich_text",
                "block_id": "WIcS",
                "elements": [
                    {
                        "type": "rich_text_section",
                        "elements": [
                            {
                                "type": "text",
                                "text": "[Bug 18658] Some 'base' examples use non-base functions, an error under R_DEFAULT_PACKAGES=NULL",
                                "style": {
                                    "bold": true
                                }
                            },
                            {
                                "type": "text",
                                "text": "\n"
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/bugs.r-project.org\/show_bug.cgi?id=18658"
                            },
                            {
                                "type": "text",
                                "text": "\n\n--- Comment #3 from Michael Chirico ("
                            },
                            {
                                "type": "link",
                                "url": "mailto:michaelchirico4@gmail.com",
                                "text": "michaelchirico4@gmail.com"
                            },
                            {
                                "type": "text",
                                "text": ") ---\nCreated attachment 3296\n  --> "
                            },
                            {
                                "type": "link",
                                "url": "https:\/\/bugs.r-project.org\/attachment.cgi?id=3296&amp;action=edit",
                                "text": "https:\/\/bugs.r-project.org\/attachment.cgi?id=3296&action=edit"
                            },
                            {
                                "type": "text",
                                "text": "\nFixes for examples in src\/library\/base\/man\n\nAttaching a patch for base -- happy to continue for the other default packages\npending feedback before sinking more time here."
                            }
                        ]
                    }
                ]
            }
        ]
    }
]